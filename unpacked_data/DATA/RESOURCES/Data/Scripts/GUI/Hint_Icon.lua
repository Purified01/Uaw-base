-- $Id: //depot/Projects/Invasion/Run/Data/Scripts/GUI/Hint_Icon.lua#8 $
--/////////////////////////////////////////////////////////////////////////////////////////////////
--
-- (C) Petroglyph Games, Inc.
--
--
--  *****           **                          *                   *
--  *   **          *                           *                   *
--  *    *          *                           *                   *
--  *    *          *     *                 *   *          *        *
--  *   *     *** ******  * **  ****      ***   * *      * *****    * ***
--  *  **    *  *   *     **   *   **   **  *   *  *    * **   **   **   *
--  ***     *****   *     *   *     *  *    *   *  *   **  *    *   *    *
--  *       *       *     *   *     *  *    *   *   *  *   *    *   *    *
--  *       *       *     *   *     *  *    *   *   * **   *   *    *    *
--  *       **       *    *   **   *   **   *   *    **    *  *     *   *
-- **        ****     **  *    ****     *****   *    **    ***      *   *
--                                          *        *     *
--                                          *        *     *
--                                          *       *      *
--                                      *  *        *      *
--                                      ****       *       *
--
--/////////////////////////////////////////////////////////////////////////////////////////////////
-- C O N F I D E N T I A L   S O U R C E   C O D E -- D O   N O T   D I S T R I B U T E
--/////////////////////////////////////////////////////////////////////////////////////////////////
--
--              $File: //depot/Projects/Invasion/Run/Data/Scripts/GUI/Hint_Icon.lua $
--
--    Original Author: Joe Howes
--
--            $Author: Maria_Teruel $
--
--            $Change: 77126 $
--
--          $DateTime: 2007/07/18 11:57:52 $
--
--          $Revision: #8 $
--
--/////////////////////////////////////////////////////////////////////////////////////////////////

require("PGBase")
require("PGDebug")
require("PGUICommands")
require("PGHintSystem")


-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- I N I T I A L I Z A T I O N
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-------------------------------------------------------------------------------
-- Initializes those elements which are unrelated to the 
-- LAN / Internet distinction.
-------------------------------------------------------------------------------
function On_Init()

	PGHintSystem_Init()
	
	
	-- ********* GUI INIT **************
	Scene = nil
	DataModelId = nil
	IsShowing = true
	Active = false
	IsLetterboxMode = false

	-- Event handlers
	Hint_Icon.Register_Event_Handler("On_Hint_Text_Dismissed", nil, On_Hint_Text_Dismissed)
	Hint_Icon.Register_Event_Handler("Animation_Finished", Hint_Icon.Quad_1, On_Icon_Animation_Finished)
	Hint_Icon.Register_Event_Handler("Update_LetterBox_Mode_State", nil, On_Update_LetterBox_Mode_State)
	
	Register_Hint_Context_Scene(Hint_Icon.Get_Containing_Scene())
end


-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- G U I   E V E N T   C A L L B A C K S
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-------------------------------------------------------------------------------
-- On_Update_LetterBox_Mode_State
-------------------------------------------------------------------------------
function On_Update_LetterBox_Mode_State(_, _, on_off)
	IsLetterboxMode = on_off
end

-------------------------------------------------------------------------------
-- On_Component_Hidden
-------------------------------------------------------------------------------
function On_Component_Hidden()
	IsShowing = false
end

-------------------------------------------------------------------------------
-- On_Component_Shown
-------------------------------------------------------------------------------
function On_Component_Shown()
	IsShowing = true
	
	-- If we are displayed while in Letterbox mode then do not flag the 
	-- zoom in animation to play!.
	-- Per bug #3301: Hint icon should remain in place and the same size throughout the un-letterboxing
	if not IsLetterboxMode then
		this.Play_Animation("Zoom_In", false)
	end
end

-------------------------------------------------------------------------------
-- Icon Click
-------------------------------------------------------------------------------
function On_Icon_Clicked(event_name, source)
	if not Active then 
		Activate_Independent_Hint(DataModelId)
		Invoke_Hint_Activation_Callback(DataModelId)
	else
		Dismiss_Hint()
	end
end

-------------------------------------------------------------------------------
--
-------------------------------------------------------------------------------
function On_Hint_Text_Dismissed()
	
end

-------------------------------------------------------------------------------
--
-------------------------------------------------------------------------------
function Play_Click() 
	Play_SFX_Event("GUI_Generic_Button_Select")
end

-------------------------------------------------------------------------------
--
-------------------------------------------------------------------------------
function Play_Alien_Steam() 
	Play_SFX_Event("SFX_Anim_Alien_Walker_Hydraulics")
end

-------------------------------------------------------------------------------
--
-------------------------------------------------------------------------------
function Prepare_Fadeout()
	-- We can't call mapped functions from the GUI we have to go through this.
	Prepare_Fades()
end


-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- G U I   D I S P L A Y   F U N C T I O N S
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------------
--
------------------------------------------------------------------------------
function On_Icon_Animation_Finished()
end


-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- G U I   R E A D   F U N C T I O N S 
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------


-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- G E N E R I C   N E T W O R K I N G
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------


-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- G U I   E V E N T S
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------


-- ------------------------------------------------------------------------------------------------------------------
-- M I S C E L L A N E O U S
-- ------------------------------------------------------------------------------------------------------------------


-------------------------------------------------------------------------------
-- Dismiss_Hint
-------------------------------------------------------------------------------
function Dismiss_Hint()
	if (DataModelId ~= nil) then
		Remove_Independent_Hint(DataModelId)
		Invoke_Hint_Dismissal_Callback(DataModelId)
		-- Play a 2D sound
		Play_SFX_Event("GUI_Hint_Text_Closed")
	end
end


-------------------------------------------------------------------------------
-- Call to tell if this hint icon is currently visible.
-------------------------------------------------------------------------------
function Is_Showing()
	return IsShowing
end

-------------------------------------------------------------------------------
-- Call to set the id of the hint to be associated with this icon.
-------------------------------------------------------------------------------
function Set_Model(model_id)
	DataModelId = model_id
end

-------------------------------------------------------------------------------
-- Call to set the parent scene of this icon.
-------------------------------------------------------------------------------
function Set_Scene(scene)
	Scene = scene
end


-------------------------------------------------------------------------------
-- Set_Active
-------------------------------------------------------------------------------
function Set_Active(on_off)
	Active = on_off
end

-- ------------------------------------------------------------------------------------------------------------------
-- Interface functions (accessible to other scenes)
-- ------------------------------------------------------------------------------------------------------------------
Interface = {}
Interface.Is_Showing = Is_Showing
Interface.Set_Model = Set_Model
Interface.Set_Scene = Set_Scene
Interface.Set_Active = Set_Active

